name: SSHX Session with Tools, Backup, and Telegram

on:
  workflow_dispatch:

jobs:
  sshx:
    runs-on: ubuntu-latest

    steps:
      - name: Launch SSHX with Setup
        env:
          BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
        run: |
          send_telegram() {
            curl -s -X POST "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
              -d chat_id="${CHAT_ID}" \
              -d text="$1"
          }

          send_telegram "ðŸš€ *GitHub SSHX Session Started!* Initializing setup..."

          echo "ðŸ“¦ Installing and launching SSHX"
          curl -sSf https://sshx.io/get | sh -s run -- bash -c '
            echo "ðŸ”§ Updating system"
            apt update && apt upgrade -y

            echo "ðŸ›  Installing tools"
            apt install -y git curl vim zip tar

            echo "ðŸ“ Creating project directory"
            mkdir -p /root/my-project
            cd /root/my-project

            echo "ðŸ—ƒ Creating backup of current files (if any)"
            if [ "$(ls -A .)" ]; then
              zip -r /root/backup_$(date +%Y%m%d_%H%M%S).zip . || echo "Backup failed"
              echo "âœ… Backup created"
            else
              echo "ðŸ“‚ No existing files to backup"
            fi

            echo "ðŸ§ª Simulating restore (extract if backup exists)"
            BACKUP_FILE=$(ls /root/backup_*.zip 2>/dev/null | tail -n1)
            if [ -f "$BACKUP_FILE" ]; then
              unzip "$BACKUP_FILE" -d /root/restored_files
              echo "âœ… Restored previous state to /root/restored_files"
            fi

            echo "ðŸš€ Environment is ready. You can run scripts or test here!"
            bash
          '

          send_telegram "âœ… *SSHX Session Finished!* Backup & tool install completed."
