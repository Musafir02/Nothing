name: Free SSHX with Tools + Backup + Restore

on:
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *' # Auto reruns every 6 hours

jobs:
  sshx:
    runs-on: ubuntu-latest

    steps:
      - name: Launch SSHX with Tools, Backup, and Restore
        run: |
          echo "ğŸš€ Starting SSHX session"

          curl -sSf https://sshx.io/get | sh -s run -- bash -c '
            set -e

            echo "ğŸ”§ Updating system..."
            apt update && apt upgrade -y

            echo "ğŸ“¦ Installing tools..."
            apt install -y git curl vim zip unzip

            echo "ğŸ“ Preparing project directory"
            mkdir -p /root/project
            cd /root/project

            echo "ğŸ“¦ Checking for backup to restore..."
            BACKUP_FILE="/root/last_backup.zip"
            if [ -f "$BACKUP_FILE" ]; then
              echo "ğŸ“‚ Restoring from backup..."
              unzip "$BACKUP_FILE" -d .
              echo "âœ… Restore complete."
            else
              echo "ğŸ•³ No previous backup found."
            fi

            echo "ğŸ§ª Working area is ready."
            echo "ğŸ“Œ To test persistence, create files in /root/project"

            # Optional work block
            sleep 60

            echo "ğŸ’¾ Saving backup before shutdown..."
            zip -r /root/last_backup.zip . || echo "âš ï¸ Backup failed"

            echo "âœ… SSHX session complete."
            bash
          '
